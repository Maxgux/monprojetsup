# MonProjetSup

## Content of the folder

- `java`: src code of the server
- `data`: data of the server (generated by fr.gouv.monprojetsup.data.back.UpdateBackData)
- `server`: server maintenance and stress tests


## Running the server

### prerequities

https://github.com/nodesource/distributions#installation-instructions

sudo apt install mvn openjdk-19-jdk openjdk-19-jre

### Install the jars

From within `monprojetsup/back/`.

```
mvn install:install-file -Dfile=java/libs/parcoursup-carte-2023-3-orientation.jar -DpomFile=java/libs/parcoursup-carte-2023-3-orientation.pom
```

```
mvn install:install-file -Dfile=java/libs/parcoursup-algos-2023-4.jar -DpomFile=java/libs/parcoursup-algos-2023-4.pom
```

### Generates the data

From within `monprojetsup/back/java/tmp`.
```
mvn compile exec:java -f../pom.xml -Dexec.mainClass=fr.gouv.monprojetsup.data.update.UpdateMonProjetSupData
```


### Generates the front dist

From within `monprojetsup/front`.
```
npm install
npm run build
```


### Start the server
From within a temporary working directory, typically `monprojetsup/back/java/tmp`.

- On a server: run the script `monprojetsup/back/server/start_server.sh`
- On a local computer

  `mvn compile exec:java -f../pom.xml -Dexec.mainClass=fr.gouv.monprojetsup.server.Server`

### 	

Create as many accounts as you want (moderation is not activated by default).
To set a user as teacher, you need an admin user.
To set a user as admin, check next section.

### Server configuration

A config file named `serverConfig.json` will automatically be created in the directory
from where the server is run. You can edit it to set the admins.


## Updating MonProjetSup data

### [optional] update parcoursup data 
Requires a direct connection to psup database

```
mvn exec:java -f../pom.xml -Dexec.mainClass=fr.gouv.monprojetsup.data.psupdb.UpdateParcoursupDataFromPsupDB
```


### update data files used by back and front
The update uses content of the `monprojetsup/data`folder to generate datafiles in the front and back folder.

```
mvn exec:java -f../pom.xml -Dexec.mainClass=fr.gouv.monprojetsup.data.UpdateMonProjetSupData
```



## OLD: Evaluation of a predictor
There is an example in EvaluateRandomPredictor.
E.g.
```
mvn exec:java -Dexec.cleanupDaemonThreads=false -Dexec.mainClass=fr.parcoursup.orientation.prod.EvaluateRandomPredictor -f pom.xml
```

EvaluateRandomPredictor first tries to load the data file 
    `OrientationData_formations.G_TA_COD_in_(4345,4332,4331,4378,26839).xml.zip`
If loading fails, it falls back to a random data set.

